<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.project.springbootcurrency.mapper.UserMapper">
    <select id="login" parameterType="cn.project.springbootcurrency.pojo.User" resultType="cn.project.springbootcurrency.pojo.User">
        SELECT * FROM `user` WHERE `phone`=#{phone} AND `password`=#{password};
    </select>
    <update id="updateUserPassword">
        update user set password = #{password} where id =#{id}
    </update>
    <insert id="register" parameterType="cn.project.springbootcurrency.pojo.Chinic">
        insert into `chinic`(`name`,`owner`,`phone`) values(#{name},#{owner},#{phone})
    </insert>
    <select id="getUserById" parameterType="int" resultType="cn.project.springbootcurrency.pojo.User">
        SELECT * FROM `user` WHERE id=#{id}
    </select>
    <select id="getRole_NameByUser_Id" parameterType="int" resultType="String">
        SELECT `role_name` FROM `role` WHERE `id` IN (SELECT `r_id` FROM `user_role` WHERE `u_id`=#{userId})
    </select>
    <update id="updateUser" parameterType="cn.project.springbootcurrency.pojo.User">
        UPDATE `user` SET `name`=#{name},`age`=#{age},`sex`=#{sex},`phone`=#{phone},`email`=#{email},
        `identity`=#{identity},`post`=#{post},`address`=#{address},`department`=#{department} WHERE `id`=#{id}
    </update>
    <update id="updateRole" parameterType="cn.project.springbootcurrency.pojo.User">
        update `user_role` set `r_id`=#{roleId} where `u_id`=#{id};
    </update>
    <select id="getUserListByRoleId" resultType="cn.project.springbootcurrency.pojo.User">
        select * from user where id in (select u_id from user_role where r_id = #{r_id})
    </select>
</mapper>